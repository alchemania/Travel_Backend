{"version":3,"file":"static/js/772.b5da1203.js","mappings":"glBA6IA,MAAMA,GAASC,EAAAA,EAAAA,KAAI,GACbC,GAAUD,EAAAA,EAAAA,KAAI,GACdE,GAAkBF,EAAAA,EAAAA,KAAI,GACtBG,GAASH,EAAAA,EAAAA,IAAI,IACbI,GAAcJ,EAAAA,EAAAA,IAAI,IAElBK,GAAYL,EAAAA,EAAAA,IAAI,CAClB,KAAQ,4BACR,OAAU,MACV,OAAU,aACV,WAAc,mBACd,SAAY,GACZ,aAAgB,sBAChB,WAAc,sBACd,KAAQ,mBACR,UAAa,kBACb,cAAgB,EAChB,YAAe,SACf,gBAAmB,CAAC,IAIlBM,EAAUC,IACZ,MAAMC,EAAOD,EAAIC,KACjB,IAAIC,EAAS,GACbD,EAAKE,SAAQC,IACT,MAAMC,EAAM,IACLD,EACHE,SAAU,CACNC,IAAMH,EAAEI,kBAAkBC,SAC1BF,IAAMH,EAAEM,gBAAgBD,kBAGzBJ,EAAIG,wBACJH,EAAIK,eACXR,EAAOS,KAAKN,EAAI,IAEpBO,QAAQC,IAAIX,GACZN,EAAOkB,MAAQZ,CAAM,GAIzBa,EAAAA,EAAAA,KAAc,KACVC,EAAAA,EAAAA,IAAUC,EAAAA,IACLC,MAAKlB,IACFD,EAAQC,EAAI,GACd,IAGV,MAAMmB,EAAWA,KACbC,EAAAA,EAAAA,QACI,+BACA,gBACA,CACIC,kBAAmB,KACnBC,iBAAkB,KAClBC,KAAM,YAEZL,MAAK,KACH1B,EAAOsB,OAAStB,EAAOsB,MACvB,IAAIb,EAAO,IACJH,EAAUgB,MACbN,kBAAkBgB,EAAAA,EAAAA,GAAW1B,EAAUgB,MAAMR,SAAS,GAAI,cAC1DI,gBAAgBc,EAAAA,EAAAA,GAAW1B,EAAUgB,MAAMR,SAAS,GAAI,eAE5D,IAAK,MAAMmB,KAAOxB,EAAKyB,gBACnBzB,EAAKyB,gBAAgBD,GAAOE,OAAO1B,EAAKyB,gBAAgBD,WAErDxB,EAAKK,SACZL,EAAK2B,YAAc,UACnBhB,QAAQC,IAAIZ,GACZe,EAAAA,EAAAA,KAAWa,EAAAA,GAAkB5B,GACxBiB,MAAKlB,IACFD,EAAQC,IACR8B,EAAAA,EAAAA,IAAe,CACXC,MAAO,SACPC,QAAS,QACTC,SAAU,EACVV,KAAM,WACR,IAELW,OAAM,MACHJ,EAAAA,EAAAA,IAAe,CACXC,MAAO,SACPC,QAAS,UACTC,SAAU,EACVV,KAAM,SACR,GACJ,GACR,EAIAY,EAAmBC,IACrBC,OAAOC,OAAOxC,EAAUgB,MAAOsB,GAC/B5C,EAAOsB,OAAStB,EAAOsB,KAAK,EAG1ByB,EAAmBC,IACrBpB,EAAAA,EAAAA,QACI,mCACA,mBACA,CACIC,kBAAmB,KACnBC,iBAAkB,KAClBC,KAAM,YAEZL,MAAK,KACHF,EAAAA,EAAAA,KAAWyB,EAAAA,GAAgB,CAAC,GAAMD,EAAGE,KAChCxB,MAAKlB,IACFY,QAAQC,IAAIb,IACZ8B,EAAAA,EAAAA,IAAe,CACXC,MAAO,SACPC,QAAS,QACTC,SAAU,EACVV,KAAM,WACR,GACJ,GACR,EAGAoB,EAAwBH,IAC1B9C,EAAQoB,OAASpB,EAAQoB,MACzBnB,EAAgBmB,OAASnB,EAAgBmB,MACzCE,EAAAA,EAAAA,KAAW4B,EAAAA,GAAqB,CAAC,GAAMJ,EAAGE,KACrCxB,MAAKlB,IACFY,QAAQC,IAAIb,GACZH,EAAYiB,MAAQd,EAAIC,KAAK,WAC7BN,EAAgBmB,OAASnB,EAAgBmB,KAAK,GAChD,E,i7LCzQV,MAAM+B,EAAc,EAEpB,O","sources":["webpack://vue-big-screen-plugin/./src/views/admin/ml/mlManage.vue","webpack://vue-big-screen-plugin/./src/views/admin/ml/mlManage.vue?f072"],"sourcesContent":["<template>\r\n    <div>\r\n        <div class=\"title\">模型部署面板 ML Panel</div>\r\n        <el-row :gutter=\"20\">\r\n            <el-col :span=\"8\" v-for=\"md in models\">\r\n                <el-card shadow=\"hover\">\r\n                    <template #header>\r\n                        <div class=\"card-header\">\r\n                            <span class=\"sub-title\">{{ md.name }}</span>\r\n                            <template v-if=\"md.isSwitchedOn === true\">\r\n                                <el-tag class=\"ml-1\" type=\"success\">已接入</el-tag>\r\n                            </template>\r\n                            <template v-else>\r\n                                <el-tag class=\"ml-1\" type=\"warning\">未接入</el-tag>\r\n                            </template>\r\n                            <template v-if=\"md.modelStatus === 'offline'\">\r\n                                <el-tag class=\"ml-2\" type=\"info\">已下线</el-tag>\r\n                            </template>\r\n                            <template v-else-if=\"md.modelStatus === 'latest'\">\r\n                                <el-tag class=\"ml-2\" type=\"success\">最新</el-tag>\r\n                            </template>\r\n                            <template v-else-if=\"md.modelStatus === 'useful'\">\r\n                                <el-tag class=\"ml-2\" type=\"warning\">基本可用</el-tag>\r\n                            </template>\r\n                            <template v-else>\r\n                                <el-tag class=\"ml-2\" type=\"danger\">已过时</el-tag>\r\n                            </template>\r\n                        </div>\r\n                        <el-button class=\"button\" text @click=handleDrawerOpen(md) style=\"align-items: end\">更新模型\r\n                        </el-button>\r\n                        <el-button class=\"button\" text @click=handleReForecast(md) style=\"align-items: end\">更新预测数据\r\n                        </el-button>\r\n                        <el-button class=\"button\" text @click=handleInsightForecast(md) style=\"align-items: end\">查看预测数据\r\n                        </el-button>\r\n                    </template>\r\n                    <div class=\"text item\">推理库: {{ md.driver }}</div>\r\n                    <div class=\"text item\">模型类型: {{ md['module'] }}</div>\r\n                    <div class=\"text item\">模型ID: {{ md.id }}</div>\r\n                    <div class=\"text item\">数据来源表: {{ md.dataSource }}</div>\r\n                    <div class=\"text item\">上次预测时间: {{ md.lastForecast }}</div>\r\n                    <div class=\"text item\">预测跨度: {{ md.hyperParameters.PRED_LENGTH }}\r\n                    </div>\r\n                    <time class=\"time\"> 更新时间: {{ md.lastUpdate }}</time>\r\n                </el-card>\r\n            </el-col>\r\n        </el-row>\r\n\r\n        <el-drawer v-model=\"drawer\" title=\"详细信息\" :with-header=\"true\">\r\n            <el-form :model=\"modelInfo\" label-width=\"140px\">\r\n                <el-form-item label=\"模型名称\">\r\n                    <el-input v-model=\"modelInfo.name\" clearable/>\r\n                </el-form-item>\r\n                <el-form-item label=\"模型编号\">\r\n                    <el-input v-model=\"modelInfo.id\" disabled/>\r\n                </el-form-item>\r\n                <el-form-item label=\"是否接入\">\r\n                    <el-switch\r\n                            v-model=\"modelInfo.isSwitchedOn\"\r\n                            :active-icon=Check\r\n                            :inactive-icon=Close\r\n                    />\r\n                </el-form-item>\r\n                <el-form-item label=\"推理库\">\r\n                    <el-input v-model=\"modelInfo.driver\" disabled/>\r\n                </el-form-item>\r\n                <el-form-item label=\"模型类型\">\r\n                    <el-input v-model=\"modelInfo.module\" disabled/>\r\n                </el-form-item>\r\n                <el-form-item label=\"数据来源表\">\r\n                    <el-input v-model=\"modelInfo.dataSource\" disabled/>\r\n                </el-form-item>\r\n                <el-form-item label=\"预测跨度\">\r\n                    <el-date-picker\r\n                            v-model=\"modelInfo.dataSpan\"\r\n                            type=\"daterange\"\r\n                            range-separator=\"To\"\r\n                            start-placeholder=\"Start date\"\r\n                            end-placeholder=\"End date\"\r\n                    />\r\n                </el-form-item>\r\n                <el-form-item label=\"上次模型更新时间\">\r\n                    <el-date-picker\r\n                            v-model=\"modelInfo.lastForecast\"\r\n                            type=\"datetime\"\r\n                            placeholder=\"Select date and time\"\r\n                            disabled\r\n                    />\r\n                </el-form-item>\r\n                <el-form-item label=\"上次数据更新时间\">\r\n                    <el-date-picker\r\n                            v-model=\"modelInfo.lastUpdate\"\r\n                            type=\"datetime\"\r\n                            placeholder=\"Select date and time\"\r\n                            disabled\r\n                    />\r\n                </el-form-item>\r\n                <el-form-item label=\"准确率\">\r\n                    <el-input v-model=\"modelInfo.precision\" disabled>\r\n                    </el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"损失率\">\r\n                    <el-input v-model=\"modelInfo.loss\" disabled>\r\n                    </el-input>\r\n                </el-form-item>\r\n                <template v-for=\"(v,k) in modelInfo.hyperParameters\">\r\n                    <el-form-item :label=k>\r\n                        <el-tooltip\r\n                                effect=\"dark\"\r\n                                content=\"请不要在不清楚其作用的情况下修改超参数，此举有可能导致严重的模型训练错误\"\r\n                                placement=\"left\"\r\n                        >\r\n                            <el-input v-model=modelInfo.hyperParameters[k] clearable/>\r\n                        </el-tooltip>\r\n                    </el-form-item>\r\n                </template>\r\n            </el-form>\r\n            <template #footer>\r\n                <el-button type=\"primary\" @click=\"onSubmit\">提交变更</el-button>\r\n                <el-button @click=\"drawer = !drawer\">取消变更</el-button>\r\n            </template>\r\n        </el-drawer>\r\n\r\n        <el-drawer v-model=\"drawer2\" title=\"预测数据内省\" :with-header=\"true\" size=\"50%\">\r\n            <el-table :data=\"dataInsight\" v-loading=\"drawer2_loading\">\r\n                <template v-for=\"(v,k) in dataInsight[0]\">\r\n                    <el-table-column :prop=k :label=k width=\"150px\"></el-table-column>\r\n                </template>\r\n            </el-table>\r\n        </el-drawer>\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {reactive, ref, onBeforeMount} from \"vue\";\r\nimport {ElMessage, ElMessageBox, ElNotification} from \"element-plus\";\r\nimport axios from \"axios\";\r\nimport {ml_get_all, ml_insight_forecast, ml_model_retrain, ml_re_forecast} from \"@/utils/request\";\r\nimport dayjs from \"dayjs\";\r\nimport {Check, Close} from \"@element-plus/icons-vue\";\r\nimport {formatTime} from \"@/utils\";\r\n\r\nconst drawer = ref(false)\r\nconst drawer2 = ref(false)\r\nconst drawer2_loading = ref(false)\r\nconst models = ref([])\r\nconst dataInsight = ref([])\r\n\r\nconst modelInfo = ref({\r\n    \"name\": \"ml_nmainland_bilstm_32_r1\",\r\n    \"module\": \".h5\",\r\n    \"driver\": \"TensorFlow\",\r\n    \"dataSource\": \"data_nonmainland\",\r\n    \"dataSpan\": [],\r\n    \"lastForecast\": \"2023-05-26T17:36:21\",\r\n    \"lastUpdate\": \"2023-05-27T14:02:32\",\r\n    \"loss\": 0.49636754393577576,\r\n    \"precision\": 0.7083333134651184,\r\n    \"isSwitchedOn\": false,\r\n    \"modelStatus\": \"latest\",\r\n    \"hyperParameters\": {},\r\n})\r\n\r\n\r\nconst refresh = res => {\r\n    const data = res.data\r\n    let newres = []\r\n    data.forEach(i => {\r\n        const tmp = {\r\n            ...i,\r\n            dataSpan: [\r\n                dayjs(i.dataLearnedBegin).toDate(),\r\n                dayjs(i.dataLearnedEnd).toDate()\r\n            ],\r\n        };\r\n        delete tmp.dataLearnedBegin\r\n        delete tmp.dataLearnedEnd\r\n        newres.push(tmp)\r\n    })\r\n    console.log(newres)\r\n    models.value = newres\r\n}\r\n\r\n\r\nonBeforeMount(() => {\r\n    axios.get(ml_get_all)\r\n        .then(res => {\r\n            refresh(res)\r\n        })\r\n})\r\n\r\nconst onSubmit = () => {\r\n    ElMessageBox.confirm(\r\n        '提示:本模型会被下线，重新上线之前数据库的数据并不会更新',\r\n        'Model Warning',\r\n        {\r\n            confirmButtonText: '确认',\r\n            cancelButtonText: '取消',\r\n            type: 'warning',\r\n        }\r\n    ).then(() => {\r\n        drawer.value = !drawer.value\r\n        let data = {\r\n            ...modelInfo.value,\r\n            dataLearnedBegin: formatTime(modelInfo.value.dataSpan[0], \"yyyy-MM-dd\"),\r\n            dataLearnedEnd: formatTime(modelInfo.value.dataSpan[1], \"yyyy-MM-dd\")\r\n        }\r\n        for (const key in data.hyperParameters) {\r\n            data.hyperParameters[key] = Number(data.hyperParameters[key])\r\n        }\r\n        delete data.dataSpan\r\n        data.modelStatus = \"offline\"\r\n        console.log(data)\r\n        axios.post(ml_model_retrain, data)\r\n            .then(res => {\r\n                refresh(res)\r\n                ElNotification({\r\n                    title: '模型更新通知',\r\n                    message: '刷新已提交',\r\n                    duration: 0,\r\n                    type: \"success\"\r\n                });\r\n            })\r\n            .catch(() => {\r\n                ElNotification({\r\n                    title: '模型更新通知',\r\n                    message: '服务器内部错误',\r\n                    duration: 0,\r\n                    type: \"error\"\r\n                });\r\n            })\r\n    })\r\n\r\n}\r\n\r\nconst handleDrawerOpen = ml => {\r\n    Object.assign(modelInfo.value, ml)\r\n    drawer.value = !drawer.value\r\n}\r\n\r\nconst handleReForecast = md => {\r\n    ElMessageBox.confirm(\r\n        '提交后数据库中数据将被自动异步刷新，建议在刷新前监视模型预测数据',\r\n        'Forecast Warning',\r\n        {\r\n            confirmButtonText: '确认',\r\n            cancelButtonText: '取消',\r\n            type: 'warning',\r\n        }\r\n    ).then(() => {\r\n        axios.post(ml_re_forecast, {'id': md.id})\r\n            .then(res => {\r\n                console.log(res)\r\n                ElNotification({\r\n                    title: '数据更新通知',\r\n                    message: '刷新已提交',\r\n                    duration: 0,\r\n                    type: \"success\"\r\n                });\r\n            })\r\n    })\r\n}\r\n\r\nconst handleInsightForecast = md => {\r\n    drawer2.value = !drawer2.value\r\n    drawer2_loading.value = !drawer2_loading.value\r\n    axios.post(ml_insight_forecast, {'id': md.id})\r\n        .then(res => {\r\n            console.log(res)\r\n            dataInsight.value = res.data['insight']\r\n            drawer2_loading.value = !drawer2_loading.value\r\n        })\r\n}\r\n\r\n</script>\r\n\r\n<style>\r\n.title {\r\n    padding: 32px;\r\n    color: #6b778c;\r\n    font-size: 32px;\r\n    font-weight: 600;\r\n}\r\n\r\n.sub-title {\r\n    color: #272727;\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n}\r\n\r\n.card-header {\r\n    display: flex;\r\n    justify-content: flex-start;\r\n    align-items: center;\r\n}\r\n\r\n\r\n.text {\r\n    font-size: 14px;\r\n}\r\n\r\n.item {\r\n    margin-bottom: 18px;\r\n}\r\n\r\n.box-card {\r\n    width: 480px;\r\n}\r\n\r\n.time {\r\n    font-size: 12px;\r\n    color: #999;\r\n}\r\n\r\n.bottom {\r\n    margin-top: 13px;\r\n    line-height: 12px;\r\n    display: flex;\r\n    justify-content: flex-start;\r\n    align-items: center;\r\n}\r\n\r\n.button {\r\n    padding: 0;\r\n    min-height: auto;\r\n    align-items: end;\r\n}\r\n\r\n.image {\r\n    width: 100%;\r\n    display: block;\r\n}\r\n</style>","import script from \"./mlManage.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./mlManage.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./mlManage.vue?vue&type=style&index=0&id=365a497b&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["drawer","ref","drawer2","drawer2_loading","models","dataInsight","modelInfo","refresh","res","data","newres","forEach","i","tmp","dataSpan","dayjs","dataLearnedBegin","toDate","dataLearnedEnd","push","console","log","value","onBeforeMount","axios","ml_get_all","then","onSubmit","ElMessageBox","confirmButtonText","cancelButtonText","type","formatTime","key","hyperParameters","Number","modelStatus","ml_model_retrain","ElNotification","title","message","duration","catch","handleDrawerOpen","ml","Object","assign","handleReForecast","md","ml_re_forecast","id","handleInsightForecast","ml_insight_forecast","__exports__"],"sourceRoot":""}