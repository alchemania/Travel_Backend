"use strict";(self["webpackChunkvue_big_screen_plugin"]=self["webpackChunkvue_big_screen_plugin"]||[]).push([[772],{9772:function(e,l,a){a.r(l),a.d(l,{default:function(){return S}});a(6106);var t=a(6226),d=a(2077),u=a(6050),n=a(3820),o=a(4460),s=a(1863),m=a(8935),i=a(2156),r=a.n(i),c=a(3685),p=a(1692);const w=(0,t._)("div",{class:"title"},"模型部署面板 ML Panel",-1),v={class:"card-header"},_={class:"sub-title"},f={class:"text item"},g={class:"text item"},b={class:"text item"},V={class:"text item"},y={class:"text item"},h={class:"text item"},W={class:"time"};var U={__name:"mlManage",setup(e){const l=(0,u.iH)(!1),a=(0,u.iH)(!1),i=(0,u.iH)(!1),U=(0,u.iH)([]),k=(0,u.iH)([]),S=(0,u.iH)({name:"ml_nmainland_bilstm_32_r1",module:".h5",driver:"TensorFlow",dataSource:"data_nonmainland",dataSpan:[],lastForecast:"2023-05-26T17:36:21",lastUpdate:"2023-05-27T14:02:32",loss:.49636754393577576,precision:.7083333134651184,isSwitchedOn:!1,modelStatus:"latest",hyperParameters:{}}),x=e=>{const l=e.data;let a=[];l.forEach((e=>{const l={...e,dataSpan:[r()(e.dataLearnedBegin).toDate(),r()(e.dataLearnedEnd).toDate()]};delete l.dataLearnedBegin,delete l.dataLearnedEnd,a.push(l)})),console.log(a),U.value=a};(0,t.wF)((()=>{s.Z.get(m.aX).then((e=>{x(e)}))}));const j=()=>{n.T.confirm("提示:本模型会被下线，重新上线之前数据库的数据并不会更新","Model Warning",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{l.value=!l.value;let e={...S.value,dataLearnedBegin:(0,p.m)(S.value.dataSpan[0],"yyyy-MM-dd"),dataLearnedEnd:(0,p.m)(S.value.dataSpan[1],"yyyy-MM-dd")};for(const l in e.hyperParameters)e.hyperParameters[l]=Number(e.hyperParameters[l]);delete e.dataSpan,e.modelStatus="offline",console.log(e),s.Z.post(m.RQ,e).then((e=>{x(e),(0,o.bM)({title:"模型更新通知",message:"刷新已提交",duration:0,type:"success"})})).catch((()=>{(0,o.bM)({title:"模型更新通知",message:"服务器内部错误",duration:0,type:"error"})}))}))},M=e=>{Object.assign(S.value,e),l.value=!l.value},P=e=>{n.T.confirm("提交后数据库中数据将被自动异步刷新，建议在刷新前监视模型预测数据","Forecast Warning",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{s.Z.post(m.Ll,{id:e.id}).then((e=>{console.log(e),(0,o.bM)({title:"数据更新通知",message:"刷新已提交",duration:0,type:"success"})}))}))},T=e=>{a.value=!a.value,i.value=!i.value,s.Z.post(m.Mc,{id:e.id}).then((e=>{console.log(e),k.value=e.data["insight"],i.value=!i.value}))};return(e,n)=>{const o=(0,t.up)("el-tag"),s=(0,t.up)("el-button"),m=(0,t.up)("el-card"),r=(0,t.up)("el-col"),p=(0,t.up)("el-row"),x=(0,t.up)("el-input"),C=(0,t.up)("el-form-item"),H=(0,t.up)("el-switch"),z=(0,t.up)("el-date-picker"),L=(0,t.up)("el-tooltip"),D=(0,t.up)("el-form"),B=(0,t.up)("el-drawer"),E=(0,t.up)("el-table-column"),F=(0,t.up)("el-table"),O=(0,t.Q2)("loading");return(0,t.wg)(),(0,t.iD)("div",null,[w,(0,t.Wm)(p,{gutter:20},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(U.value,(e=>((0,t.wg)(),(0,t.j4)(r,{span:8},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{shadow:"hover"},{header:(0,t.w5)((()=>[(0,t._)("div",v,[(0,t._)("span",_,(0,d.zw)(e.name),1),!0===e.isSwitchedOn?((0,t.wg)(),(0,t.j4)(o,{key:0,class:"ml-1",type:"success"},{default:(0,t.w5)((()=>[(0,t.Uk)("已接入")])),_:1})):((0,t.wg)(),(0,t.j4)(o,{key:1,class:"ml-1",type:"warning"},{default:(0,t.w5)((()=>[(0,t.Uk)("未接入")])),_:1})),"offline"===e.modelStatus?((0,t.wg)(),(0,t.j4)(o,{key:2,class:"ml-2",type:"info"},{default:(0,t.w5)((()=>[(0,t.Uk)("已下线")])),_:1})):"latest"===e.modelStatus?((0,t.wg)(),(0,t.j4)(o,{key:3,class:"ml-2",type:"success"},{default:(0,t.w5)((()=>[(0,t.Uk)("最新")])),_:1})):"useful"===e.modelStatus?((0,t.wg)(),(0,t.j4)(o,{key:4,class:"ml-2",type:"warning"},{default:(0,t.w5)((()=>[(0,t.Uk)("基本可用")])),_:1})):((0,t.wg)(),(0,t.j4)(o,{key:5,class:"ml-2",type:"danger"},{default:(0,t.w5)((()=>[(0,t.Uk)("已过时")])),_:1}))]),(0,t.Wm)(s,{class:"button",text:"",onClick:l=>M(e),style:{"align-items":"end"}},{default:(0,t.w5)((()=>[(0,t.Uk)("更新模型 ")])),_:2},1032,["onClick"]),(0,t.Wm)(s,{class:"button",text:"",onClick:l=>P(e),style:{"align-items":"end"}},{default:(0,t.w5)((()=>[(0,t.Uk)("更新预测数据 ")])),_:2},1032,["onClick"]),(0,t.Wm)(s,{class:"button",text:"",onClick:l=>T(e),style:{"align-items":"end"}},{default:(0,t.w5)((()=>[(0,t.Uk)("查看预测数据 ")])),_:2},1032,["onClick"])])),default:(0,t.w5)((()=>[(0,t._)("div",f,"推理库: "+(0,d.zw)(e.driver),1),(0,t._)("div",g,"模型类型: "+(0,d.zw)(e["module"]),1),(0,t._)("div",b,"模型ID: "+(0,d.zw)(e.id),1),(0,t._)("div",V,"数据来源表: "+(0,d.zw)(e.dataSource),1),(0,t._)("div",y,"上次预测时间: "+(0,d.zw)(e.lastForecast),1),(0,t._)("div",h,"预测跨度: "+(0,d.zw)(e.hyperParameters.PRED_LENGTH),1),(0,t._)("time",W," 更新时间: "+(0,d.zw)(e.lastUpdate),1)])),_:2},1024)])),_:2},1024)))),256))])),_:1}),(0,t.Wm)(B,{modelValue:l.value,"onUpdate:modelValue":n[12]||(n[12]=e=>l.value=e),title:"详细信息","with-header":!0},{footer:(0,t.w5)((()=>[(0,t.Wm)(s,{type:"primary",onClick:j},{default:(0,t.w5)((()=>[(0,t.Uk)("提交变更")])),_:1}),(0,t.Wm)(s,{onClick:n[11]||(n[11]=e=>l.value=!l.value)},{default:(0,t.w5)((()=>[(0,t.Uk)("取消变更")])),_:1})])),default:(0,t.w5)((()=>[(0,t.Wm)(D,{model:S.value,"label-width":"140px"},{default:(0,t.w5)((()=>[(0,t.Wm)(C,{label:"模型名称"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:S.value.name,"onUpdate:modelValue":n[0]||(n[0]=e=>S.value.name=e),clearable:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(C,{label:"模型编号"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:S.value.id,"onUpdate:modelValue":n[1]||(n[1]=e=>S.value.id=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(C,{label:"是否接入"},{default:(0,t.w5)((()=>[(0,t.Wm)(H,{modelValue:S.value.isSwitchedOn,"onUpdate:modelValue":n[2]||(n[2]=e=>S.value.isSwitchedOn=e),"active-icon":(0,u.SU)(c.JrY),"inactive-icon":(0,u.SU)(c.x8P)},null,8,["modelValue","active-icon","inactive-icon"])])),_:1}),(0,t.Wm)(C,{label:"推理库"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:S.value.driver,"onUpdate:modelValue":n[3]||(n[3]=e=>S.value.driver=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(C,{label:"模型类型"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:S.value.module,"onUpdate:modelValue":n[4]||(n[4]=e=>S.value.module=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(C,{label:"数据来源表"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:S.value.dataSource,"onUpdate:modelValue":n[5]||(n[5]=e=>S.value.dataSource=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(C,{label:"预测跨度"},{default:(0,t.w5)((()=>[(0,t.Wm)(z,{modelValue:S.value.dataSpan,"onUpdate:modelValue":n[6]||(n[6]=e=>S.value.dataSpan=e),type:"daterange","range-separator":"To","start-placeholder":"Start date","end-placeholder":"End date"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(C,{label:"上次模型更新时间"},{default:(0,t.w5)((()=>[(0,t.Wm)(z,{modelValue:S.value.lastForecast,"onUpdate:modelValue":n[7]||(n[7]=e=>S.value.lastForecast=e),type:"datetime",placeholder:"Select date and time",disabled:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(C,{label:"上次数据更新时间"},{default:(0,t.w5)((()=>[(0,t.Wm)(z,{modelValue:S.value.lastUpdate,"onUpdate:modelValue":n[8]||(n[8]=e=>S.value.lastUpdate=e),type:"datetime",placeholder:"Select date and time",disabled:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(C,{label:"准确率"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:S.value.precision,"onUpdate:modelValue":n[9]||(n[9]=e=>S.value.precision=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(C,{label:"损失率"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:S.value.loss,"onUpdate:modelValue":n[10]||(n[10]=e=>S.value.loss=e),disabled:""},null,8,["modelValue"])])),_:1}),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(S.value.hyperParameters,((e,l)=>((0,t.wg)(),(0,t.j4)(C,{label:l},{default:(0,t.w5)((()=>[(0,t.Wm)(L,{effect:"dark",content:"请不要在不清楚其作用的情况下修改超参数，此举有可能导致严重的模型训练错误",placement:"left"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:S.value.hyperParameters[l],"onUpdate:modelValue":e=>S.value.hyperParameters[l]=e,clearable:""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["label"])))),256))])),_:1},8,["model"])])),_:1},8,["modelValue"]),(0,t.Wm)(B,{modelValue:a.value,"onUpdate:modelValue":n[13]||(n[13]=e=>a.value=e),title:"预测数据内省","with-header":!0,size:"50%"},{default:(0,t.w5)((()=>[(0,t.wy)(((0,t.wg)(),(0,t.j4)(F,{data:k.value},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(k.value[0],((e,l)=>((0,t.wg)(),(0,t.j4)(E,{prop:l,label:l,width:"150px"},null,8,["prop","label"])))),256))])),_:1},8,["data"])),[[O,i.value]])])),_:1},8,["modelValue"])])}}};const k=U;var S=k}}]);
//# sourceMappingURL=772.b5da1203.js.map